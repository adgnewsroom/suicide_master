<html>
  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Gelasio|Roboto&display=swap" rel="stylesheet">

    <style>

body {
   background-color:#D9D9D9;
}

h2 {
  font-family: 'Gelasio', serif;
  text-align: center;
  font-weight: bold;
}


h3 {
  font-family: 'Roboto', sans-serif;
  font-weight: bold;
}


p {
  max-width: 730px;
  margin: auto;
  padding: 0 15px;
  margin-bottom: 1em;
  font-family: 'Gelasio', serif;
  font-size: 1.3em;
}

p:first-of-type:first-letter {
    float: left;
    font-size: 65px;
    line-height: 1;
    font-weight: bold;
    margin-right: 9px;
}


.states {
    stroke: #fff;
    stroke-width:1px;
}

.states:hover{
  opacity: .6;
}

.legendLinear text {
    font-size: 12px;
}

.d3-tip {
  line-height: 1;
  padding: 12px;
  background: BlanchedAlmond;
  border: 1px solid #2F4F4F;
  opacity: 0.8;
  border-radius: 2px;
}


  </style>
  </head>
  <body>


    <P>Kelsey Bell is alive; she’s happy a lot of the time.</p>

    <p>The now-19-year-old attempted suicide when she was 13 after years of dealing with depression, anxiety and an eating disorder. She says her recovery has highs and lows, but she’s stable now —
    enough so that she is a junior board member with the American Foundation for Suicide Prevention and is majoring in psychology.</p>

    <p>“I guess that pain turned into passion,” Kelsey said.</p>

    <p>The rates of suicides by minors have been on a climb for the past several years. In Arkansas, they’ve increased from 10 in 2010 to 27 in 2017, according to federal mortality data from the Centers for Disease Control and Prevention.</p>

    <p>Beginning in September 2018, the Arkansas Democrat-Gazette began gathering prosecutorial files, coroners’ reports, archived news articles, Department of Human Services records and police reports on the deaths of children in every county in Arkansas from 2012 to 2017.</p>

    <p>The newspaper then created a database of those deaths to analyze the cause, manner and circumstances surrounding each death. The findings showed that children in almost every county in the state died by suicide over that time span.</p>

    <p>The oldest was just a few months away from his 18th birthday, and the youngest was about to turn 6. All but 13 were by teenagers.</p>

    <p>Twenty-one of the suicides examined by the newspaper were by girls, and 42 — about 66% — were by boys.</p>

    <p>Some reports listed histories of mental health problems or major life changes such as a breakup, death in the family or a sudden move. Others listed no such history.</p>

    <p>The reports are incomplete, as shown when comparing the newspaper’s database with federal mortality data. Some coroners didn’t have records for every year requested because their predecessors had taken records home with them when they left office.</p>

    <p>Federal data show that 119 children died in Arkansas from 2012 to 2017, the most recent year for which data are available. Documents gathered by the newspaper show only 63 reports of suicide.</p>

    <p>Research shows that suicide is the second-leading reason for death in people ages 15 to 24. The numbers have increased as well for young children under the age of 10, according to the CDC.</p>

    <p>Experts who work in suicide prevention, research and mental health advocacy weren’t able to identify the reason behind these increases — all said that there are many possible explanations.</p>

    <p>Throughout the state, efforts to prevent suicides, educate Arkansans and decrease stigmas surrounding mental health are ramping up.</p>

    <p>“One suicide is too many suicides,” said Mary Meacham, the chair of education and prevention for the Arkansas chapter of the American Foundation for Suicide Prevention.</p>

    <h2>‘Really sad’</h2>

    <p>Kelsey was 9 when her mother, Ladeana Bell, first noticed mental health problems in her daughter. Ladeana drove to Kelsey’s elementary school and saw the other children running and playing. Kelsey, though, was lying on the ground, lethargic and trying to take a nap.</p>

    <p>“This little girl is really sad,” Ladeana thought to herself.</p>

    <p>Ladeana is a licensed therapist with a private practice and knew how to get help for her daughter. She’d bring up the idea of therapy, but at first Kelsey was resistant.</p>

    <p>“Sometimes I wonder if I should have pushed harder,” Ladeana said in an interview earlier this month.</p>

    <p>Kelsey started therapy when she was 11. She says it made it difficult to foster relationships with her peers; she didn’t want to tell anyone that she was going to therapy.</p>

    <p>There wasn’t one particular reason that she attempted suicide two years after starting therapy, she said. She’d gotten into a fight with a friend that day, but her problems went well beyond that.</p>

    <p>Her eating disorder wasn’t getting better, and she says she wasn’t engaging with her therapy. Her depression, she said, manifested itself as anger much of the time.</p>

    <p>“It was just things piling up,” Kelsey said. ” … I just knew I didn’t want to be alive anymore.”</p>

    <p>Those interviewed by the newspaper agreed that it’s nearly impossible to learn the reason for the increase in suicides by children.</p>

    <p>“Each case is its own,” Meacham said.</p>

    <p>But, Meacham added, more research is needed, particularly into suicides by minors.</p>

    <p>“The funding for research hasn’t been there,” she said. ” … We need to treat this like any public health issue.”</p>

    <p>The largest spike in completed suicides by children are in 14-year-olds, said Buster Lackey, the executive director of the Arkansas chapter of the National Alliance on Mental Illness.</p>

    <p>Suicide is the second-leading cause of death in teenagers, according to the CDC.</p>

    <p>Lackey, like other experts interviewed by the newspaper, cited concerns about the growing role of social media in kids’ lives as one of the possible contributors to increases in suicide rates. He specifically addressed the ways in which the internet has allowed kids to bully each other 24/7 or for adults to bully children online.</p>

    <p>“When I got on the bus or got home, it was over,” he said. “It’s not like that anymore.”</p>

    <p>Kelsey said social media is still hard for her — the barrage of filtered photos depicting the best parts of everyone else’s lives can make her feel like she is less-than.</p>

    <p>Several experts also cited well-publicized cases of suicide’s relation to social media such as that of Michelle Conrad, who encouraged her boyfriend to kill himself via social media in 2014.</p>

    <p>Ladeana added that kids have access to more information, some of which may be harmful. Kelsey used to look at “dark stuff” online that encouraged self-harm, Ladeana said.</p>

    <p>In addition to social media, Ladeana said she thinks that the country’s growing political division has damaged the sense of community and decency. She formerly served as the Arkansas chapter’s research chairwoman.</p>

    <p>“It’s cattiness,” she said. “There a lot of ‘mean-girl’ behavior.”</p>

    <h2>Death classification</h2>

    <p>Coroners are also more cognizant of the need to classify suicides as such, Lackey said. Lackey is also a deputy coroner in Lonoke County who helped to develop a training on investigating infant deaths for Arkansas coroners.</p>

    <p>“A coroner has a pretty powerful position,” Lackey said.</p>

    <p>Coroners determine the means of death — homicide, suicide, accidental or natural. In Arkansas, coroners are elected by a county-wide vote with the exception of Faulkner and Pulaski counties where the coroners are elected.</p>

    <p>There are no training requirements for coroners in Arkansas, but Lackey said in recent years there have been more efforts to train coroners on suicides, overdoses and infant deaths.</p>

    Samanatha Minster on this

    ‘Cultural change’


    <div class ='container-fluid'>
      <div class='row'>
        <div id="chart"></div>
          <div id="vis"></div>

          <div class='header'>
            <h3>Suicides by minors from 1999 to 2017 in Arkansas and surrounding states</h3>
            <p>The number of suicides by minors has been increasing for several years nationally, according to federal mortality data. Experts say there are many possible reasons for the rise, but it's impossible to pin down one reason.</p>
          </div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="//d3js.org/queue.v1.min.js"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="d3-legend.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.7.1/d3-tip.min.js"></script>
    <script src="map.js"></script>



    <script>
      var glines
      var mouseG
      var tooltip

      var parseDate = d3.timeParse("%Y")

      var margin = {top: 80, right: 200, bottom: 40, left: 80}
      var width = 1400 - margin.left - margin.right
      var height = 800 - margin.top - margin.bottom

      var lineOpacity = 0.8
      var lineStroke = "4px"

      var axisPad = 7 // axis formatting
      var R = 6 //legend marker

      var category = ["Arkansas", "Texas", "Tennessee", "Oklahoma", "Missouri", "Mississippi", "Louisiana"]
      // since Category B and E are really close to each other, assign them diverging colors
      var color = d3.scaleOrdinal()
        .domain(category)
        .range(["#e41a1c", "#399283", "#43dcc5", "#0b522e", "#bfcd8e", "#5ab220", "#33547a"])
      d3.csv("data.csv", data => {

        var res = data.map((d,i) => {
          return {
            date : parseDate(d.year),
            bidding_no : d.bidding_no,
            state : d.state,
            rate : d.rate
          }
        })

        var xScale = d3.scaleTime()
          .domain(d3.extent(res, d=>d.date))
          .range([0, width])


        var yScale = d3.scaleLinear()
          .domain([0, 21])
          .range([height, 0]);

        var svg = d3.select("#chart").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append('g')
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


        // CREATE AXES //
        // render axis first before lines so that lines will overlay the horizontal ticks
        var xAxis = d3.axisBottom(xScale).ticks(d3.timeYear.every(1)).tickSizeOuter(axisPad*2).tickSizeInner(axisPad*2)
        var yAxis = d3.axisLeft(yScale).ticks(10, "s").tickSize(-width) //horizontal ticks across svg width

        svg.append("g")
          .attr("class", "x axis")
          .attr("transform", `translate(0, ${height})`)
          .call(xAxis)
          .call(g => {
            var years = xScale.ticks(d3.timeYear.every(1))
            var xshift = (width/(years.length))/5 - 16
            g.selectAll("text").attr("transform", `translate(${xshift}, 0)`) //shift tick labels to middle of interval
              .style("text-anchor", "left")
              .attr("y", axisPad+10)
              .attr('fill', 'black')
              .style("font-family", "Roboto")
              .style("font-size", 15)
              .style("font-weight", "bold")

            g.selectAll("line")
              .attr('stroke', 'black')

            g.select(".domain")
              .attr('stroke', 'black')

          })



        svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
          .call(g => {
            g.selectAll("text")
            .style("text-anchor", "middle")
            .attr("x", -axisPad*2)
            .attr('fill', 'black')
            .style("font-family", "Roboto")
            .style("font-size", 15)



            g.selectAll("line")
              .attr('stroke', 'black')
              .attr('stroke-width', 0.7) // make horizontal tick thinner and lighter so that line paths can stand out
              .attr('opacity', 0.3)

            g.select(".domain").remove()

           })
          .append('text')
            .attr('x', 130)
            .attr("y", 5)
            .attr("fill", "black")
            .text("Suicides per 100,000")
            .style("font-family", "Roboto")
            .style("font-size", "15px")


        // CREATE LEGEND //
        var svgLegend = svg.append('g')
            .attr('class', 'gLegend')
            .attr("transform", "translate(" + (width + 20) + "," + 0 + ")")

        var legend = svgLegend.selectAll('.legend')
          .data(category)
          .enter().append('g')
            .attr("class", "legend")
            .attr("transform", function (d, i) {return "translate(0," + i * 25 + ")"})

            svgLegend.append("rect")
                    .attr("width", 115)
                    .attr("height", 185)
                    .attr("x", -120)
                    .attr("y", 490)
                    .style("fill", "black")
                    .style("opacity", "0.1")


        legend.append("circle")
            .attr("class", "legend-node")
            .attr("cx", -101)
            .attr("cy", 508)
            .attr("r", 8)
            .style("fill", d=>color(d))
            // .style("padding", "30px")

        legend.append("text")
            .attr("class", "legend-text")
            .attr("x", -90)
            .attr("y", 514)
            .style("fill", "black")
            .style("font-size", 15)
            .style("font-family", "Roboto")
            .text(d=>d)








        // line generator
        var line = d3.line()
          .x(d => xScale(d.date))
          .y(d => yScale(d.rate))

        renderChart(1) // inital chart render (set default to Bidding Exercise 1 data)

        function renderChart(bidding_no) {
        //
          var resNew = res.filter(d=>d.bidding_no == parseInt(bidding_no))
        //

          var res_nested = d3.nest() // necessary to nest data so that keys represent each state category
            .key(d=>d.state)
            .entries(resNew)

          // APPEND MULTIPLE LINES //
          var lines = svg.append('g')
            .attr('class', 'lines')

          glines = lines.selectAll('.line-group')
            .data(res_nested).enter()
            .append('g')
            .attr('class', 'line-group')

          glines
            .append('path')
              .attr('class', 'line')
              .attr('d', d => line(d.values))
              .style('stroke', (d, i) => color(i))
              .style('fill', 'none')
              .style('opacity', lineOpacity)
              .style('stroke-width', lineStroke)


          // APPEND CIRCLE MARKERS //
          var gcircle = lines.selectAll("circle-group")
            .data(res_nested).enter()
            .append("g")
            .attr('class', 'circle-group')

          gcircle.selectAll("circle")
            .data(d => d.values).enter()
            .append("g")
            .attr("class", "circle")
            .append("circle")
            .attr("cx", d => xScale(d.date))
            .attr("cy", d => yScale(d.rate))
            .attr("r", 2)

          // CREATE HOVER TOOLTIP WITH VERTICAL LINE //
          tooltip = d3.select("#chart").append("div")
            .attr('id', 'tooltip')
            .style('position', 'absolute')
            .style("background-color", "white")
            .style('padding', 6)
            .style('display', 'none')

          mouseG = svg.append("g")
            .attr("class", "mouse-over-effects");

          mouseG.append("path") // create vertical line to follow mouse
            .attr("class", "mouse-line")
            .style("stroke", "#A9A9A9")
            .style("stroke-width", 1.5)
            .style("opacity", "0");

          var lines = document.getElementsByClassName('line');

          var mousePerLine = mouseG.selectAll('.mouse-per-line')
            .data(res_nested)
            .enter()
            .append("g")
            .attr("class", "mouse-per-line");

          mousePerLine.append("circle")
            .attr("r", 3)
            .style("stroke", function (d) {
              return color(d.key)
            })
            .style("fill", "none")
            .style("stroke-width", 2)
            .style("opacity", "0");

          mouseG.append('svg:rect') // append a rect to catch mouse movements on canvas
            .attr('width', width)
            .attr('height', height)
            .attr('fill', 'none')
            .attr('pointer-events', 'all')
            .on('mouseout', function () { // on mouse out hide line, circles and text
              d3.select(".mouse-line")
                .style("opacity", "0");
              d3.selectAll(".mouse-per-line circle")
                .style("opacity", "0");
              d3.selectAll(".mouse-per-line text")
                .style("opacity", "0");
              d3.selectAll("#tooltip")
                .style('display', 'none')

            })
            .on('mouseover', function () { // on mouse in show line, circles and text
              d3.select(".mouse-line")
                .style("opacity", "1");
              d3.selectAll(".mouse-per-line circle")
                .style("opacity", "1");
              d3.selectAll("#tooltip")
                .style('display', 'block')
            })
            .on('mousemove', function () { // update tooltip content, line, circles and text when mouse moves
              var mouse = d3.mouse(this)

              d3.selectAll(".mouse-per-line")
                .attr("transform", function (d, i) {
                  var xDate = xScale.invert(mouse[0]) // use 'invert' to get date corresponding to distance from mouse position relative to svg
                  var bisect = d3.bisector(function (d) { return d.date; }).left // retrieve row index of date on parsed csv
                  var idx = bisect(d.values, xDate);

                  d3.select(".mouse-line")
                    .attr("d", function () {
                      var data = "M" + xScale(d.values[idx].date) + "," + (height);
                      data += " " + xScale(d.values[idx].date) + "," + 0;
                      return data;
                    });
                  return "translate(" + xScale(d.values[idx].date) + "," + yScale(d.values[idx].rate) + ")";

                });

              updateTooltipContent(mouse, res_nested)

            })
          }

      function updateTooltipContent(mouse, res_nested) {

        sortingObj = []
        res_nested.map(d => {
          var xDate = xScale.invert(mouse[0])
          var bisect = d3.bisector(function (d) { return d.date; }).left
          var idx = bisect(d.values, xDate)
          sortingObj.push({key: d.values[idx].state, rate: d.values[idx].rate, year: d.values[idx].date.getFullYear()})
        })

        sortingObj.sort(function(x, y){
           return d3.descending(x.rate, y.rate);
        })

        var sortingArr = sortingObj.map(d=> d.key)

        var res_nested1 = res_nested.slice().sort(function(a, b){
          return sortingArr.indexOf(a.key) - sortingArr.indexOf(b.key) // rank vehicle category based on price of rate
        })

        tooltip.html(sortingObj[0].date)
          .style('display', 'block')
          .style('left', d3.event.pageX + 20)
          .style('top', d3.event.pageY - 20)
          .style('font-size', 11.5)
          .style('opacity', 0.8)
          .selectAll()
          .data(res_nested1).enter() // for each vehicle category, list out name and price of rate
          .append('div')
          .style('color', "black")
          .style('font-size', 16)
          .style('font-weight', "bold")
          .style("font-family", "Roboto")
          .html(d => {
            var xDate = xScale.invert(mouse[0])
            var bisect = d3.bisector(function (d) { return d.date; }).left
            var idx = bisect(d.values, xDate)
            return d.key + ": " + d.values[idx].rate.toString()
          })
      }

    })

    </script>

  </body>
</html>
